version: '3.8'

services:
  mcp-conductor:
    build: .
    image: mcp-conductor:latest
    container_name: mcp-conductor
    stdin_open: true
    tty: true
    volumes:
      - ./workspace:/workspace
      - ./mcp-config.json:/app/mcp-config.json:ro
    environment:
      - MCP_CONDUCTOR_WORKSPACE=/workspace
      - MCP_CONDUCTOR_RUN_ARGS=allow-read=/workspace,allow-write=/workspace
      - MCP_CONDUCTOR_DEFAULT_TIMEOUT=30000
      - MCP_CONDUCTOR_MAX_TIMEOUT=300000
      - MCP_CONDUCTOR_MCP_CONFIG=/app/mcp-config.json
    restart: unless-stopped

  mcp-conductor-network:
    build: .
    image: mcp-conductor:latest
    container_name: mcp-conductor-network
    stdin_open: true
    tty: true
    volumes:
      - ./workspace:/workspace
      - ./mcp-config.json:/app/mcp-config.json:ro
    environment:
      - MCP_CONDUCTOR_WORKSPACE=/workspace
      - MCP_CONDUCTOR_RUN_ARGS=allow-read=/workspace,allow-write=/workspace,allow-net
      - MCP_CONDUCTOR_DEFAULT_TIMEOUT=30000
      - MCP_CONDUCTOR_MAX_TIMEOUT=300000
      - MCP_CONDUCTOR_MCP_CONFIG=/app/mcp-config.json
    restart: unless-stopped

  mcp-conductor-http:
    build: .
    image: mcp-conductor:latest
    container_name: mcp-conductor-http
    command: ['http']
    ports:
      - '3000:3000'
    volumes:
      - ./workspace:/workspace
      - ./mcp-config.json:/app/mcp-config.json:ro
    environment:
      - MCP_CONDUCTOR_WORKSPACE=/workspace
      - MCP_CONDUCTOR_RUN_ARGS=allow-read=/workspace,allow-write=/workspace,allow-net
      - MCP_CONDUCTOR_DEFAULT_TIMEOUT=30000
      - MCP_CONDUCTOR_MAX_TIMEOUT=300000
      - MCP_CONDUCTOR_MCP_CONFIG=/app/mcp-config.json
      - PORT=3000
    restart: unless-stopped
    healthcheck:
      test: ['CMD', 'curl', '-f', 'http://localhost:3000/health']
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
